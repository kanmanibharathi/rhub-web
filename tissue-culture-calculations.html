<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>One Research Hub - Tissue Culture Calculations</title>
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-edu-meeting.css">
    <style>
        .calc-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: 100%;
            transition: transform 0.3s, border-color 0.3s;
        }

        .calc-card:hover {
            transform: translateY(-5px);
            border-color: #00a651;
        }

        .calc-card h4 {
            color: #00a651;
            font-size: 18px;
            margin-bottom: 25px;
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            color: #ccc;
            font-size: 13px;
            margin-bottom: 5px;
            display: block;
        }

        .calc-input-group {
            display: flex;
            gap: 10px;
        }

        .calc-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            padding: 8px 15px;
            font-size: 14px;
        }

        .calc-select {
            width: 95px;
            background: #333;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            padding: 8px;
            font-size: 13px;
            cursor: pointer;
            outline: none;
        }

        .calc-select option {
            background: #333;
            color: #fff;
        }

        .calc-btn {
            width: 100%;
            background: #d63384;
            border: none;
            padding: 12px;
            border-radius: 10px;
            color: #fff;
            font-weight: 600;
            margin-top: 15px;
            transition: background 0.3s;
        }

        .calc-btn:hover {
            background: #00a651;
        }

        .result-box {
            background: rgba(0, 166, 81, 0.1);
            border: 1px solid rgba(0, 166, 81, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            display: none;
            color: #ccc;
            line-height: 1.6;
            text-align: left;
        }

        .result-content {
            font-size: 14px;
            font-style: italic;
        }

        .step-heading {
            color: #00a651;
            font-weight: 700;
            margin-top: 15px;
            margin-bottom: 5px;
            font-style: normal;
            display: block;
        }

        .instruction-title {
            font-weight: 700;
            color: #fff;
            margin-bottom: 10px;
            font-style: normal;
            display: block;
            font-size: 16px;
        }

        /* Toggle Styles */
        .mode-toggle {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 5px;
            gap: 5px;
        }

        .mode-option {
            flex: 1;
            text-align: center;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            color: #ccc;
            transition: all 0.3s ease;
            user-select: none;
        }

        .mode-option.active {
            background: #00a651;
            color: #fff;
            font-weight: 600;
        }

        .mode-option:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
        }

        /* Range Slider Styling */
        input[type=range].calc-range {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            height: 6px;
            border-radius: 5px;
            outline: none;
            margin: 15px 0;
        }

        input[type=range].calc-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #00a651;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 0 5px rgba(0, 166, 81, 0.5);
            transition: transform 0.2s;
        }

        input[type=range].calc-range::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        input[type=range].calc-range::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #00a651;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 0 5px rgba(0, 166, 81, 0.5);
        }

        .pgr-selection-container {
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .pgr-radio-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 10px;
            width: 100%;
            align-items: center;
        }

        @media (max-width: 767px) {
            .pgr-radio-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .pgr-radio-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <header class="header-area header-sticky">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav class="main-nav">
                        <a href="index.html" class="logo">
                            <img src="assets/images/logo.png" alt="Research Hub Logo">
                            <div class="logo-text">
                                <span class="title">Research Hub</span>
                                <span class="tagline">Where Research Meets Expertise</span>
                            </div>
                        </a>
                        <ul class="nav">
                            <li><a href="index.html">Home</a></li>
                            <li><a href="events.html">Events</a></li>
                            <li><a href="book-slot.html">Book Now</a></li>
                            <li class="has-sub">
                                <a href="javascript:void(0)">Pages</a>
                                <ul class="sub-menu">
                                    <li><a href="events.html">Events</a></li>
                                    <li><a href="products.html">Products</a></li>
                                    <li><a href="courses.html">Courses</a></li>
                                    <li><a href="team.html">Meet Our Team</a></li>
                                    <li><a href="https://www.youtube.com/@Research-Hub" target="_blank"
                                            style="color: #FF0000 !important; font-weight: bold;">YouTube</a></li>
                                </ul>
                            </li>
                            <li class="has-sub">
                                <a href="javascript:void(0)" class="active">Statistics</a>
                                <ul class="sub-menu">
                                    <li><a href="lab-calculations.html">Lab Calculations</a></li>
                                    <li><a href="buffer-recipes.html">Buffer Recipes</a></li>
                                    <li><a href="buffer-recipes.html?id=tris-hcl">Tris Calculator</a></li>
                                    <li><a href="buffer-recipes.html?id=borate">Borate Calculator</a></li>
                                    <li><a href="https://researchhub.shinyapps.io/onewayanova/" target="_blank">Data
                                            Analysis</a></li>
                                </ul>
                            </li>
                            <li><a href="index.html#contact">Contact Us</a></li>
                            <li class="user-profile">
                                <a href="javascript:void(0)" id="user-menu-toggle">
                                    <i class="fa fa-user"></i>
                                </a>
                                <div class="user-dropdown" id="user-dropdown">
                                    <a href="javascript:void(0)" id="show-login">Login</a>
                                    <a href="javascript:void(0)" id="show-signup">Sign Up</a>
                                </div>
                            </li>
                        </ul>
                        <a class='menu-trigger'><span>Menu</span></a>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <section class="meetings-page" id="meetings"
        style="padding-top: 150px; min-height: 100vh; display: flex; flex-direction: column;">
        <div class="container" style="flex: 1;">
            <div class="row">
                <div class="col-lg-12">
                    <a href="lab-calculations.html" class="back-to-lab">
                        <i class="fa fa-home"></i>
                        <span>Back to Lab Calculations</span>
                    </a>
                </div>
                <div class="col-lg-12 text-center mb-5">
                    <div class="section-heading">
                        <h2>Tissue Culture Calculators</h2>
                    </div>
                </div>
            </div>

            <style>
                .sidebar-nav {
                    position: sticky;
                    top: 170px;
                }

                .nav-box {
                    background: rgba(255, 255, 255, 0.05);
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    padding: 15px;
                    border-radius: 12px;
                    margin-bottom: 15px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    display: flex;
                    align-items: center;
                    gap: 12px;
                    color: #fff;
                }

                .nav-box i {
                    width: 35px;
                    height: 35px;
                    background: rgba(0, 166, 81, 0.1);
                    color: #00a651;
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 16px;
                }

                .nav-box span {
                    font-size: 14px;
                    font-weight: 600;
                }

                .nav-box:hover {
                    background: rgba(255, 255, 255, 0.1);
                    transform: translateX(5px);
                    border-color: rgba(0, 166, 81, 0.3);
                }

                .nav-box.active {
                    background: rgba(0, 166, 81, 0.15);
                    border-color: #00a651;
                }

                .nav-box.active i {
                    background: #00a651;
                    color: #fff;
                }

                @media (max-width: 991px) {
                    .sidebar-nav {
                        position: relative;
                        top: 0;
                        margin-bottom: 30px;
                        display: grid;
                        grid-template-columns: 1fr 1fr 1fr;
                        gap: 10px;
                    }

                    .nav-box {
                        margin-bottom: 0;
                        padding: 10px;
                        flex-direction: column;
                        text-align: center;
                    }

                    .nav-box span {
                        font-size: 12px;
                    }
                }

                @media (max-width: 575px) {
                    .sidebar-nav {
                        grid-template-columns: 1fr;
                    }
                }

                .calc-section {
                    transition: opacity 0.4s ease;
                }

                .back-to-lab {
                    display: inline-flex;
                    align-items: center;
                    gap: 10px;
                    color: #fff;
                    background: rgba(255, 255, 255, 0.05);
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    padding: 10px 18px;
                    border-radius: 10px;
                    font-weight: 500;
                    font-size: 14px;
                    transition: all 0.3s ease;
                    margin-bottom: 20px;
                }

                .back-to-lab:hover {
                    background: #00a651;
                    color: #fff;
                    border-color: #00a651;
                    transform: translateY(-2px);
                }

                .stock-guide-link:hover {
                    background: rgba(0, 166, 81, 0.1) !important;
                    border-color: #00a651 !important;
                    color: #fff !important;
                    transform: translateY(-2px);
                }

                .back-to-lab i {
                    font-size: 16px;
                }
            </style>

            <div class="row">
                <div class="col-lg-3">
                    <div class="sidebar-nav">
                        <div class="nav-box active" onclick="showCalculator('converter', this)">
                            <i class="fa fa-exchange"></i>
                            <span>Converter (¬µM ‚áÑ mg/L)</span>
                        </div>
                        <div class="nav-box" onclick="showCalculator('pgr-calc', this)">
                            <i class="fa fa-flask"></i>
                            <span>PGR Preparation</span>
                        </div>
                        <div class="nav-box" onclick="showCalculator('ster-calc', this)">
                            <i class="fa fa-shield"></i>
                            <span>Sterilization Calculator</span>
                        </div>
                        <div class="nav-box" onclick="showCalculator('phosphate-buffer', this)">
                            <i class="fa fa-flask"></i>
                            <span>Phosphate Buffer Preparation</span>
                        </div>
                    </div>
                </div>
                <div class="col-lg-9">
                    <!-- Converter Section -->
                    <div id="section-converter" class="calc-section">
                        <div class="calc-card">
                            <h3 class="text-center mb-4" style="color: #fff; font-weight: 700; font-size: 22px;">PGR
                                Concentration Converter (¬µM ‚áÑ mg/L)</h3>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="form-label">Select PGR</label>
                                        <div id="conv-pgr-group"
                                            style="display: flex; flex-wrap: wrap; gap: 20px; align-items: center; margin-top: 10px;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4 align-items-center">
                                <div class="col-md-5">
                                    <div class="form-group mb-0">
                                        <label class="form-label">Concentration (¬µM)</label>
                                        <input type="number" id="conv-um" class="calc-input w-100"
                                            placeholder="Enter ¬µM" step="0.01">
                                    </div>
                                </div>
                                <div class="col-md-2 text-center mt-4">
                                    <i class="fa fa-exchange" style="color: #00a651; font-size: 20px;"></i>
                                </div>
                                <div class="col-md-5">
                                    <div class="form-group mb-0">
                                        <label class="form-label">Concentration (mg/L)</label>
                                        <input type="number" id="conv-mgl" class="calc-input w-100"
                                            placeholder="Enter mg/L" step="0.01">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PGR Prep Section -->
                    <div id="section-pgr-calc" class="calc-section" style="display: none;">
                        <div class="calc-card">
                            <h3 class="text-center mb-4" style="color: #fff; font-weight: 700; font-size: 22px;">PGR
                                preparation calculator</h3>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group mb-4">
                                        <label class="form-label">Calculation Mode</label>
                                        <div class="mode-toggle" id="mode-toggle" style="max-width: 400px;">
                                            <div class="mode-option active" data-value="mass">Mass based (mg/L)</div>
                                            <div class="mode-option" data-value="molar">Molar based (¬µM / mM)</div>
                                        </div>
                                        <input type="hidden" id="mode" value="mass">
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div id="pgr-full-container" class="pgr-selection-container">
                                        <div class="form-group mb-0">
                                            <label class="form-label">Plant Growth Regulator (PGR)</label>
                                            <div id="pgr-radio-group" class="pgr-radio-grid"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4 align-items-end">
                                <div class="col-md-12">
                                    <h4
                                        style="border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; margin-bottom: 20px; color: #fff;">
                                        Stock Solution</h4>
                                </div>
                                <div class="col-md-7">
                                    <div class="form-group mb-md-0">
                                        <div class="d-flex justify-content-between align-items-center mb-1">
                                            <label class="form-label mb-0">Stock concentration</label>
                                            <div id="pgr-stock-unit-toggle" class="mode-toggle"
                                                style="width: auto; padding: 2px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1);">
                                                <label class="mode-option active"
                                                    style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                                    <input type="radio" name="pgr-stock-unit" value="mgml" checked
                                                        style="display: none;" onchange="toggleMolarityUnit(this)">mg/mL
                                                </label>
                                            </div>
                                        </div>
                                        <input type="number" id="stockConc" class="calc-input w-100" value="1"
                                            step="0.01">
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="form-group mb-0">
                                        <label class="form-label">Stock volume (mL)</label>
                                        <input type="number" id="stockVol" class="calc-input w-100" value="100">
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4 align-items-end">
                                <div class="col-md-12">
                                    <h4
                                        style="border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; margin-bottom: 20px; color: #fff;">
                                        Final Medium</h4>
                                </div>
                                <div class="col-md-7">
                                    <div class="form-group mb-md-0">
                                        <div class="d-flex justify-content-between align-items-center mb-1">
                                            <label class="form-label mb-0">Desired concentration</label>
                                            <div id="pgr-final-unit-toggle" class="mode-toggle"
                                                style="width: auto; padding: 2px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1);">
                                                <label class="mode-option active"
                                                    style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                                    <input type="radio" name="pgr-final-unit" value="mgL" checked
                                                        style="display: none;" onchange="toggleMolarityUnit(this)">mg/L
                                                </label>
                                            </div>
                                        </div>
                                        <input type="number" id="finalConc" class="calc-input w-100" value="1"
                                            step="0.01">
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="form-group mb-md-0">
                                        <div class="d-flex justify-content-between align-items-center mb-1">
                                            <label class="form-label mb-0">Medium volume</label>
                                            <div id="pgr-media-unit-toggle" class="mode-toggle"
                                                style="width: auto; padding: 2px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1);">
                                                <label class="mode-option"
                                                    style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                                    <input type="radio" name="pgr-media-unit" value="mL"
                                                        style="display: none;" onchange="toggleMolarityUnit(this)">mL
                                                </label>
                                                <label class="mode-option active"
                                                    style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                                    <input type="radio" name="pgr-media-unit" value="L" checked
                                                        style="display: none;" onchange="toggleMolarityUnit(this)">L
                                                </label>
                                            </div>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <input type="number" id="mediaVol" class="calc-input w-100" value="1"
                                                step="0.1">
                                            <button class="calc-btn" onclick="calculate()"
                                                style="width: auto; padding: 10px 20px; margin-top: 0; white-space: nowrap;">Calculate</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="result" class="result-box">
                                <span class="instruction-title">Instructions:</span>
                                <div id="result-text" class="result-content"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Sterilization Section -->
                    <div id="section-ster-calc" class="calc-section" style="display: none;">
                        <div class="calc-card">
                            <h3 class="text-center mb-4" style="color: #fff; font-weight: 700; font-size: 22px;">
                                Sterilization Solution Calculator</h3>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Sterilant Type</label>
                                        <select id="sterilant" class="calc-input w-100" style="background: #333;">
                                            <option value="">-- Select Sterilant --</option>
                                            <option value="naocl">Sodium Hypochlorite (NaOCl)</option>
                                            <option value="caocl2">Ca(OCl)2 (Calcium Hypochlorite)</option>
                                            <option value="hgcl2">HgCl2 (Mercuric Chloride)</option>
                                            <option value="h2o2">H2O2 (Hydrogen Peroxide)</option>
                                            <option value="ethanol">Ethanol (70%)</option>
                                            <option value="agno3">AgNO3 (Silver Nitrate)</option>
                                            <option value="bromine">Bromine Water</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Calculation Mode</label>
                                        <div class="mode-toggle" id="ster-mode-toggle">
                                            <div class="mode-option active" data-value="percentage">Percentage (%)</div>
                                            <div class="mode-option" data-value="molarity">Molarity (M)</div>
                                        </div>
                                        <input type="hidden" id="ster-mode" value="percentage">
                                    </div>
                                </div>
                            </div>
                            <div id="liquid-stock-group" style="display: none;">
                                <div class="row mt-4 align-items-end">
                                    <div class="col-md-6">
                                        <div class="form-group mb-0">
                                            <label class="form-label">Stock Concentration (%)</label>
                                            <input type="number" id="s1_stock_conc" class="calc-input w-100" value="5">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4 align-items-end">
                                <div class="col-md-5">
                                    <div class="form-group mb-md-0">
                                        <div class="d-flex justify-content-between align-items-center mb-1">
                                            <label class="form-label mb-0" id="ster-desired-label">Desired Conc.
                                                (%)</label>
                                            <div id="ster-molar-unit-toggle-group" class="mode-toggle"
                                                style="width: auto; padding: 2px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); display: none;">
                                                <label class="mode-option active"
                                                    style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                                    <input type="radio" name="ster-molar-unit" value="M"
                                                        style="display: none;" onchange="toggleMolarityUnit(this)">M
                                                </label>
                                                <label class="mode-option"
                                                    style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                                    <input type="radio" name="ster-molar-unit" value="mM" checked
                                                        style="display: none;" onchange="toggleMolarityUnit(this)">mM
                                                </label>
                                            </div>
                                            <span id="ster-percent-label"
                                                style="color: #00a651; font-weight: 600; font-size: 13px;">%</span>
                                        </div>
                                        <input type="number" id="s1_desired_conc" class="calc-input w-100" value="1">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group mb-md-0">
                                        <div class="d-flex justify-content-between align-items-center mb-1">
                                            <label class="form-label mb-0">Final Volume</label>
                                            <div id="ster-vol-unit-toggle" class="mode-toggle"
                                                style="width: auto; padding: 2px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1);">
                                                <label class="mode-option active"
                                                    style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                                    <input type="radio" name="ster-vol-unit" value="mL" checked
                                                        style="display: none;" onchange="toggleMolarityUnit(this)">mL
                                                </label>
                                                <label class="mode-option"
                                                    style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                                    <input type="radio" name="ster-vol-unit" value="L"
                                                        style="display: none;" onchange="toggleMolarityUnit(this)">L
                                                </label>
                                            </div>
                                        </div>
                                        <input type="number" id="s1_final_vol" class="calc-input w-100" value="100">
                                    </div>
                                </div>
                                <div class="col-md-3 text-md-end">
                                    <button class="calc-btn" onclick="calculateSterilization()"
                                        style="width: auto; padding: 10px 20px; margin-top: 0;">Calculate</button>
                                </div>
                            </div>
                            <div id="ster-warning" class="result-box"
                                style="background: rgba(214, 51, 132, 0.1); border-color: rgba(214, 51, 132, 0.3); color: #ff6b6b; display: none;">
                                ‚ö†Ô∏è <span id="ster-warning-text"></span>
                            </div>
                            <div id="ster-result" class="result-box">
                                <span class="instruction-title">Instructions:</span>
                                <div id="ster-result-text" class="result-content"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Phosphate Buffer Section -->
                    <div id="section-phosphate-buffer" class="calc-section" style="display: none;">
                        <div class="calc-card">
                            <h3 class="text-center mb-4" style="color: #fff; font-weight: 700; font-size: 22px;">
                                <i class="fa fa-flask" style="color: #00a651; margin-right: 10px;"></i>Phosphate Buffer
                                Preparation
                            </h3>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Buffer Type</label>
                                        <div class="mt-2">
                                            <div class="mb-2">
                                                <label
                                                    style="cursor: pointer; display: flex; align-items: center; color: #fff; font-size: 14px;">
                                                    <input type="radio" name="pb-type" value="sodium" checked
                                                        style="accent-color: #00a651; width: 18px; height: 18px; margin-right: 10px;">
                                                    Sodium Phosphate (NaH‚ÇÇPO‚ÇÑ / Na‚ÇÇHPO‚ÇÑ)
                                                </label>
                                            </div>
                                            <div>
                                                <label
                                                    style="cursor: pointer; display: flex; align-items: center; color: #fff; font-size: 14px;">
                                                    <input type="radio" name="pb-type" value="potassium"
                                                        style="accent-color: #00a651; width: 18px; height: 18px; margin-right: 10px;">
                                                    Potassium Phosphate (KH‚ÇÇPO‚ÇÑ / K‚ÇÇHPO‚ÇÑ)
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Desired pH: <span id="pb-ph-val"
                                                style="color: #00a651; font-weight: 700;">7.0</span></label>
                                        <input type="range" id="pb-ph" class="calc-range" value="7.0" step="0.1"
                                            min="5.8" max="8.0"
                                            oninput="document.getElementById('pb-ph-val').textContent = this.value">
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <div class="d-flex justify-content-between align-items-center mb-1">
                                            <label class="form-label mb-0">Desired Buffer Molarity</label>
                                            <div class="mode-toggle"
                                                style="width: auto; padding: 2px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1);">
                                                <label class="mode-option active"
                                                    style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                                    <input type="radio" name="pb-target-unit" value="M" checked
                                                        style="display: none;" onchange="toggleMolarityUnit(this)">M
                                                </label>
                                                <label class="mode-option"
                                                    style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                                    <input type="radio" name="pb-target-unit" value="mM"
                                                        style="display: none;" onchange="toggleMolarityUnit(this)">mM
                                                </label>
                                            </div>
                                        </div>
                                        <input type="number" id="pb-target-m" class="calc-input w-100"
                                            placeholder="e.g. 0.1" step="0.01">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Stock Molarity (M)</label>
                                        <input type="number" id="pb-stock-m" class="calc-input w-100"
                                            placeholder="e.g. 0.2" step="0.01">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <div class="d-flex justify-content-between align-items-center mb-1">
                                            <label class="form-label mb-0">Final Volume</label>
                                            <div class="mode-toggle"
                                                style="width: auto; padding: 2px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1);">
                                                <label class="mode-option active"
                                                    style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                                    <input type="radio" name="pb-final-unit" value="mL" checked
                                                        style="display: none;" onchange="toggleMolarityUnit(this)">mL
                                                </label>
                                                <label class="mode-option"
                                                    style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                                    <input type="radio" name="pb-final-unit" value="L"
                                                        style="display: none;" onchange="toggleMolarityUnit(this)">L
                                                </label>
                                            </div>
                                        </div>
                                        <input type="number" id="pb-final-vol" class="calc-input w-100" value="1000">
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4 align-items-center">
                                <div class="col-6">
                                    <a href="molarity-calculator.html?calc=molarity" class="stock-guide-link"
                                        style="color: #00a651; font-size: 13px; text-decoration: none; display: inline-flex; align-items: center; border: 1px solid rgba(0, 166, 81, 0.2); padding: 6px 14px; border-radius: 8px; background: rgba(255, 255, 255, 0.05); transition: all 0.3s ease;">
                                        <i class="fa fa-info-circle" style="margin-right: 8px;"></i>
                                        Stock Solution Guide
                                    </a>
                                </div>
                                <div class="col-6 text-end">
                                    <button class="calc-btn" onclick="calculatePhosphateBuffer()"
                                        style="width: auto; padding: 10px 20px; margin-top: 0;">Calculate</button>
                                </div>
                            </div>
                            <div id="pb-result" class="result-box">
                                <span class="instruction-title">Preparation instruction:</span>
                                <div id="pb-result-text" class="result-content"></div>
                                <div id="pb-educational"
                                    style="margin-top: 15px; padding: 10px; background: rgba(0, 166, 81, 0.05); border-radius: 8px; font-size: 11px; display: none;">
                                    <div style="font-weight: 700; color: #00a651; margin-bottom: 5px;">Educational Mode:
                                        Calculation Details</div>
                                    <div id="pb-edu-content"
                                        style="font-family: monospace; white-space: pre-wrap; color: #999;"></div>
                                </div>
                            </div>
                            <div class="mt-4 p-3"
                                style="background: rgba(255,255,255,0.08); border-radius: 10px; font-size: 13px; color: #fff;">
                                <p class="mb-2" style="color: #fff;"><strong style="color: #00a651;">üìù
                                        Principles:</strong> Phosphate
                                    buffers are made using acid‚Äìbase conjugate pairs. The pK<sub>a2</sub> is
                                    approximately 7.21 at 25¬∞C.</p>
                                <p class="mb-0" style="color: #fff;"><strong style="color: #00a651;">üí° Note:</strong>
                                    Use Na<sup>+</sup>
                                    buffers for general biochemical work and K<sup>+</sup> buffers for enzyme or plant
                                    physiology studies. Adjust pH at room temperature.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer" style="padding: 20px 0px; background: transparent; margin-top: 50px;">
            <p>Copyright ¬© 2024 One Research Hub. All Rights Reserved.</p>
        </div>
    </section>

    <script>
        function showCalculator(id, el) {
            document.querySelectorAll('.calc-section').forEach(s => s.style.display = 'none');
            const target = document.getElementById('section-' + id);
            if (target) target.style.display = 'block';

            document.querySelectorAll('.nav-box').forEach(b => b.classList.remove('active'));
            if (el) {
                el.classList.add('active');
            } else {
                const boxes = document.querySelectorAll('.nav-box');
                boxes.forEach(box => {
                    if (box.getAttribute('onclick').includes(`'${id}'`)) box.classList.add('active');
                });
            }
            // Save state to localStorage
            localStorage.setItem('active_tc_calc', id);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const calcId = urlParams.get('calc') || localStorage.getItem('active_tc_calc');
            if (calcId) {
                showCalculator(calcId);
            }
        });
    </script>
    <!-- Scripts -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="assets/js/custom.js"></script>
    <script src="assets/js/user-auth.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const pgrData = {
                // Main PGRs
                "IAA": 175.18, "NAA": 186.21, "IBA": 203.24, "2,4-D": 221.04, "BAP": 225.25, "GA3": 346.38, "TDZ": 220.25, "ABA": 264.32,
                "Abscisic acid (ABA)": 264.32,
                // Chemical Elicitors
                "Methyl jasmonate": 224.31, "Methyl jasmonate (MeJA)": 224.31, "Jasmonic acid": 210.23, "Jasmonic acid (JA)": 210.23,
                "Salicylic acid": 138.12, "Salicylic acid (SA)": 138.12, "Acetylsalicylic acid": 180.16,
                "Ethephon": 144.49, "Ethephon (ethylene-releasing)": 144.49, "Hydrogen peroxide": 34.01, "Hydrogen peroxide (H2O2)": 34.01,
                "Sodium nitroprusside": 297.95, "Nitric oxide donors (SNP)": 297.95, "Silver nitrate": 169.87,
                "Brassinosteroids": 480.68, "Jasmonates (JA, MeJA)": 217.0, // average or specific
                "Ethylene (gas or ethephon)": 144.49,
                // Biotic / Complex (Mass based only)
                "Chitosan": null, "Yeast extract": null,
                "Fungal cell wall extracts": null, "Bacterial cell extracts": null,
                "Oligosaccharides": null, "Glucans": null, "Lipopolysaccharides (LPS)": null,
                "Pectin fragments": null, "Cell wall polysaccharides": null, "Oligogalacturonides": null,
                "Plant extracts": null, "Endogenous signaling molecules": null
            };

            const elicitorCategories = [
                {
                    title: "Common Elicitors",
                    items: ["Methyl jasmonate", "Salicylic acid", "Chitosan", "Yeast extract", "Silver nitrate", "Hydrogen peroxide"]
                },
                {
                    title: "Biotic Elicitors (Microbial)",
                    items: ["Yeast extract", "Fungal cell wall extracts", "Bacterial cell extracts", "Chitosan", "Oligosaccharides", "Glucans", "Lipopolysaccharides (LPS)"]
                },
                {
                    title: "Biotic Elicitors (Plant-Derived)",
                    items: ["Pectin fragments", "Cell wall polysaccharides", "Oligogalacturonides", "Plant extracts", "Endogenous signaling molecules"]
                },
                {
                    title: "Abiotic Elicitors",
                    items: ["Methyl jasmonate (MeJA)", "Jasmonic acid (JA)", "Salicylic acid (SA)", "Acetylsalicylic acid", "Abscisic acid (ABA)", "Hydrogen peroxide (H2O2)", "Nitric oxide donors (SNP)"]
                },
                {
                    title: "Hormonal Elicitors",
                    items: ["Salicylic acid", "Brassinosteroids", "Ethylene (gas or ethephon)", "Abscisic acid (ABA)"]
                }
            ];

            const pgrSelect = document.getElementById("pgr");
            const modeInput = document.getElementById("mode");
            const modeToggle = document.getElementById("mode-toggle");
            const stockUnit = document.getElementById("stockUnit");
            const finalUnit = document.getElementById("finalUnit");

            // Mode switching logic via toggle
            modeToggle.addEventListener("click", function (e) {
                const option = e.target.closest(".mode-option");
                if (!option) return;

                modeToggle.querySelectorAll(".mode-option").forEach(opt => opt.classList.remove("active"));
                option.classList.add("active");

                const val = option.getAttribute("data-value");
                modeInput.value = val;

                const stockToggle = document.getElementById("pgr-stock-unit-toggle");
                const finalToggle = document.getElementById("pgr-final-unit-toggle");

                if (val === "mass") {
                    stockToggle.innerHTML = `
                            <label class="mode-option active" style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                <input type="radio" name="pgr-stock-unit" value="mgml" checked style="display: none;" onchange="toggleMolarityUnit(this)">mg/mL
                            </label>`;
                    finalToggle.innerHTML = `
                            <label class="mode-option active" style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                <input type="radio" name="pgr-final-unit" value="mgL" checked style="display: none;" onchange="toggleMolarityUnit(this)">mg/L
                            </label>`;
                } else {
                    stockToggle.innerHTML = `
                            <label class="mode-option active" style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                <input type="radio" name="pgr-stock-unit" value="M" style="display: none;" onchange="toggleMolarityUnit(this)">M
                            </label>
                            <label class="mode-option" style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                <input type="radio" name="pgr-stock-unit" value="mM" checked style="display: none;" onchange="toggleMolarityUnit(this)">mM
                            </label>`;
                    finalToggle.innerHTML = `
                            <label class="mode-option active" style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                <input type="radio" name="pgr-final-unit" value="uM" checked style="display: none;" onchange="toggleMolarityUnit(this)">¬µM
                            </label>
                            <label class="mode-option" style="padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-bottom: 0;">
                                <input type="radio" name="pgr-final-unit" value="mM" style="display: none;" onchange="toggleMolarityUnit(this)">mM
                            </label>`;
                }
            });

            const pgrRadioGroup = document.getElementById("pgr-radio-group");
            const convPgrGroup = document.getElementById("conv-pgr-group");
            const convUmInput = document.getElementById("conv-um");
            const convMglInput = document.getElementById("conv-mgl");

            // Populate PGRs
            const mainPGRs = ["2,4-D", "ABA", "BAP", "GA3", "IAA", "IBA", "NAA", "TDZ"];
            mainPGRs.sort().forEach((pgr, index) => {
                const label = document.createElement("label");
                label.style.cssText = "cursor: pointer; display: flex; align-items: center; color: #fff; font-size: 14px; margin-bottom: 0;";
                label.innerHTML = `
                    <input type="radio" name="pgr-selection" value="${pgr}" ${pgr === 'BAP' ? 'checked' : ''} style="accent-color: #00a651; width: 18px; height: 18px; margin-right: 10px;">
                    ${pgr}
                `;
                pgrRadioGroup.appendChild(label);
            });

            // Populate Elicitors Sections
            const pgrFullContainer = document.getElementById("pgr-full-container");

            // Helper to clear dropdowns when a radio is clicked
            function clearElicitorDropdowns() {
                document.querySelectorAll('.elicitor-dropdown').forEach(sel => sel.value = "");
            }

            // Update main PGR radios to clear dropdowns
            pgrRadioGroup.querySelectorAll('input[name="pgr-selection"]').forEach(input => {
                input.addEventListener('change', clearElicitorDropdowns);
            });

            elicitorCategories.forEach(cat => {
                const dropdownCats = ["Biotic Elicitors (Microbial)", "Biotic Elicitors (Plant-Derived)", "Abiotic Elicitors", "Hormonal Elicitors"];

                if (dropdownCats.includes(cat.title)) {
                    // Create a flex container for Title + Dropdown
                    const wrapper = document.createElement("div");
                    wrapper.style.cssText = "display: flex; align-items: center; margin-top: 15px; gap: 20px; width: 100%;";

                    const head = document.createElement("label");
                    head.className = "form-label mb-0";
                    head.textContent = cat.title;
                    head.style.cssText = "white-space: nowrap; width: 240px; flex-shrink: 0; color: #fff; font-size: 14px;";

                    const select = document.createElement("select");
                    select.className = "calc-input elicitor-dropdown";
                    select.style.cssText = "background: #333; flex-grow: 1; padding: 10px 15px; margin-top: 0; height: 45px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);";
                    select.innerHTML = `<option value="">-- Select Option --</option>`;

                    cat.items.forEach(pgr => {
                        const opt = document.createElement("option");
                        opt.value = pgr;
                        opt.textContent = pgr;
                        select.appendChild(opt);
                    });

                    select.addEventListener("change", function () {
                        if (this.value) {
                            document.querySelectorAll('input[name="pgr-selection"]').forEach(rb => rb.checked = false);
                            document.querySelectorAll('.elicitor-dropdown').forEach(sel => {
                                if (sel !== this) sel.value = "";
                            });
                        }
                    });

                    wrapper.appendChild(head);
                    wrapper.appendChild(select);
                    pgrFullContainer.appendChild(wrapper);
                } else {
                    const head = document.createElement("label");
                    head.className = "form-label mt-4";
                    head.textContent = cat.title;
                    pgrFullContainer.appendChild(head);

                    const grid = document.createElement("div");
                    grid.className = "pgr-radio-grid";
                    cat.items.forEach(pgr => {
                        const label = document.createElement("label");
                        label.style.cssText = "cursor: pointer; display: flex; align-items: center; color: #fff; font-size: 14px; margin-bottom: 0;";
                        label.innerHTML = `
                            <input type="radio" name="pgr-selection" value="${pgr}" style="accent-color: #00a651; width: 18px; height: 18px; margin-right: 10px;">
                            ${pgr}
                        `;
                        const input = label.querySelector('input');
                        input.addEventListener('change', clearElicitorDropdowns);
                        grid.appendChild(label);
                    });
                    pgrFullContainer.appendChild(grid);
                }
            });

            // Populate Converter (Only with MWs, single line)
            Object.keys(pgrData).filter(k => pgrData[k] !== null).sort().forEach((pgr, index) => {
                const label = document.createElement("label");
                label.style.cssText = "cursor: pointer; display: flex; align-items: center; color: #fff; font-size: 13px; margin-bottom: 0; white-space: nowrap;";
                label.innerHTML = `
                    <input type="radio" name="conv-pgr-selection" value="${pgr}" ${pgr === 'BAP' ? 'checked' : ''} onchange="updateConvMw()" style="accent-color: #00a651; width: 16px; height: 16px; margin-right: 8px;">
                    ${pgr}
                `;
                convPgrGroup.appendChild(label);
            });

            // Converter Logic
            function updateConvMw() {
                convUmInput.value = "";
                convMglInput.value = "";
            }

            function convertUmToMgl() {
                const um = parseFloat(convUmInput.value);
                const selectedPgr = document.querySelector('input[name="conv-pgr-selection"]:checked').value;
                const mw = pgrData[selectedPgr];
                if (!isNaN(um)) {
                    const mgl = (um * mw) / 1000;
                    convMglInput.value = mgl.toFixed(4);
                } else {
                    convMglInput.value = "";
                }
            }

            function convertMglToUm() {
                const mgl = parseFloat(convMglInput.value);
                const selectedPgr = document.querySelector('input[name="conv-pgr-selection"]:checked').value;
                const mw = pgrData[selectedPgr];
                if (!isNaN(mgl)) {
                    const um = (mgl * 1000) / mw;
                    convUmInput.value = um.toFixed(4);
                } else {
                    convUmInput.value = "";
                }
            }



            convUmInput.addEventListener("input", convertUmToMgl);
            convMglInput.addEventListener("input", convertMglToUm);

            // Initialize MW
            updateConvMw();

            window.calculate = function () {
                let pgr = "";
                const pgrChecked = document.querySelector('input[name="pgr-selection"]:checked');
                if (pgrChecked) {
                    pgr = pgrChecked.value;
                } else {
                    const activeDropdown = Array.from(document.querySelectorAll('.elicitor-dropdown')).find(sel => sel.value !== "");
                    if (activeDropdown) pgr = activeDropdown.value;
                }

                if (!pgr) {
                    const resultBox = document.getElementById("result");
                    const resultText = document.getElementById("result-text");
                    resultBox.style.display = "block";
                    resultBox.style.borderColor = "#ff4d4d";
                    resultText.innerHTML = "‚ö†Ô∏è Please select a PGR or Elicitor for calculation.";
                    return;
                }

                const mw = pgrData[pgr];

                const mode = document.getElementById("mode").value;
                const resultBox = document.getElementById("result");
                const resultText = document.getElementById("result-text");

                if (mode === "molar" && !mw) {
                    resultBox.style.display = "block";
                    resultBox.style.borderColor = "#ff4d4d";
                    resultText.innerHTML = `‚ö†Ô∏è <b>Mode Conflict:</b> Molar calculation is not available for "<b>${pgr}</b>" because it is a complex extract or polymer without a fixed molecular weight. Please switch to "<b>Mass based (mg/L)</b>" mode for this substance.`;
                    return;
                }

                const sConc = Number(document.getElementById("stockConc").value);
                const sUnit = document.querySelector('input[name="pgr-stock-unit"]:checked').value;
                const sVol = Number(document.getElementById("stockVol").value);

                const fConc = Number(document.getElementById("finalConc").value);
                const fUnit = document.querySelector('input[name="pgr-final-unit"]:checked').value;

                let mVol = Number(document.getElementById("mediaVol").value);
                const mUnit = document.querySelector('input[name="pgr-media-unit"]:checked').value;
                const mVol_display = mVol;
                const mUnit_display = mUnit;

                if (mUnit === "mL") mVol = mVol / 1000;

                // Basic validation
                if (
                    !pgr || sConc <= 0 || sVol <= 0 ||
                    fConc <= 0 || mVol <= 0
                ) {
                    resultBox.style.display = "block";
                    resultBox.style.borderColor = "#ff4d4d";
                    resultText.innerHTML = "‚ö†Ô∏è Please enter valid, non-zero values in all fields.";
                    return;
                }

                let stock_mM, stockWeight_mg;

                // Stock calculation
                if (sUnit === "mgml") {
                    stockWeight_mg = sConc * sVol;
                    stock_mM = (sConc * 1000) / mw;
                } else {
                    stockWeight_mg = sConc * mw * (sVol / 1000);
                    stock_mM = sConc;
                }

                // Final concentration conversion
                let final_mM;
                if (fUnit === "mgL") {
                    final_mM = fConc / mw;
                } else {
                    final_mM = fConc / 1000;
                }

                const volToAdd_L = (final_mM * mVol) / stock_mM;
                const volToAdd_mL = volToAdd_L * 1000;
                const volToAdd_uL = volToAdd_L * 1000000;

                let displayVol, displayUnit;
                if (volToAdd_mL >= 1) {
                    displayVol = volToAdd_mL.toFixed(2);
                    displayUnit = "mL";
                } else {
                    displayVol = volToAdd_uL.toFixed(2);
                    displayUnit = "¬µL";
                }

                resultBox.style.display = "block";
                resultBox.style.borderColor = "rgba(0, 166, 81, 0.3)";

                const stockUnitText = sUnit === "mgml" ? "mg/mL" : "mM";
                const finalUnitText = fUnit === "mgL" ? "mg/L" : "¬µM";
                let displayWeight, weightUnit;
                if (stockWeight_mg >= 1) {
                    displayWeight = stockWeight_mg.toFixed(2);
                    weightUnit = "mg";
                } else {
                    displayWeight = (stockWeight_mg * 1000).toFixed(2);
                    weightUnit = "¬µg";
                }

                resultText.innerHTML = `
                    <span class="step-heading">Step 1: Stock Preparation</span>
                    To prepare a <b>${sConc} ${stockUnitText}</b> stock solution of <b>${pgr}</b> (MW: ${mw} g/mol), weigh <b>${displayWeight} ${weightUnit}</b> of the powder and dissolve it in a small amount of appropriate solvent (e.g., EtOH, NaOH, or water as per PGR requirement), then make up the volume to <b>${sVol} mL</b>.

                    <span class="step-heading">Step 2: Media Preparation</span>
                    To achieve a final concentration of <b>${fConc} ${finalUnitText}</b> in <b>${mVol_display} ${mUnit_display}</b> of culture medium, add <b>${displayVol} ${displayUnit}</b> of the prepared stock solution. 

                    <div style="margin-top: 15px; font-size: 0.85em; opacity: 0.8;">
                        <b>Note:</b> Filter sterilize the stock solution using a 0.22 ¬µm syringe filter and add it to the medium after autoclaving, once it has cooled to approximately 45‚Äì50 ¬∞C.
                    </div>
                `;
            };

            // Sterilization Calculator Logic
            const sterToggle = document.getElementById("ster-mode-toggle");
            const sterModeInput = document.getElementById("ster-mode");
            const sterTypeSelect = document.getElementById("sterilant");
            const liquidGroup = document.getElementById("liquid-stock-group");
            const unitSelect = document.getElementById("ster-unit-select");
            const desiredLabel = document.getElementById("ster-desired-label");

            const sterData = {
                "naocl": { type: "liquid", mw: 74.44, rec: "0.5‚Äì1.5%", time: "5‚Äì15 min", use: "Soft tissues, leaves, nodal explants" },
                "caocl2": { type: "solid", mw: 142.98, rec: "2‚Äì5% (w/v)", time: "10‚Äì30 min", use: "Woody, hard explants" },
                "hgcl2": { type: "solid", mw: 271.50, rec: "0.05‚Äì0.1% (w/v)", time: "2‚Äì8 min", use: "Highly contaminated explants" },
                "h2o2": { type: "liquid", mw: 34.01, rec: "3‚Äì6%", time: "5‚Äì10 min", use: "Seeds, delicate tissues" },
                "ethanol": { type: "liquid", mw: 46.07, rec: "70%", time: "30‚Äì60 sec", use: "Surface sterilization of most explants" },
                "agno3": { type: "solid", mw: 169.87, rec: "0.1‚Äì0.5%", time: "5‚Äì10 min", use: "Bacterial contamination" },
                "bromine": { type: "liquid", mw: 159.81, rec: "Saturated", time: "2‚Äì5 min", use: "Rare, outdated method" }
            };

            function updateSterUI() {
                const sterKey = sterTypeSelect.value;
                const ster = sterData[sterKey];
                const mode = sterModeInput.value;
                const warningBox = document.getElementById("ster-warning");
                const warningText = document.getElementById("ster-warning-text");

                if (!ster) {
                    liquidGroup.style.display = "none";
                    warningBox.style.display = "none";
                    return;
                }

                // Toggle visibility of stock concentration for solid vs liquid
                liquidGroup.style.display = (ster.type === "liquid" && mode === "percentage") ? "block" : "none";

                const molarToggleGroup = document.getElementById("ster-molar-unit-toggle-group");
                const percentLabel = document.getElementById("ster-percent-label");

                // Update units and options
                if (mode === "molarity") {
                    molarToggleGroup.style.display = "flex";
                    percentLabel.style.display = "none";
                    desiredLabel.textContent = "Desired Molarity";
                } else {
                    molarToggleGroup.style.display = "none";
                    percentLabel.style.display = "inline";
                    desiredLabel.textContent = "Desired Concentration";
                }

                // Safety Logic
                const desiredValue = Number(document.getElementById("s1_desired_conc").value);
                let warnings = [];

                if (sterKey === "hgcl2") {
                    warnings.push("‚ò†Ô∏è Toxic warning: Handle with extreme care!");
                }

                // Convert current input to an approximate percentage for threshold checking
                let currentPercent = desiredValue;
                if (mode === "molarity") {
                    if (sterKey === "h2o2") {
                        currentPercent = desiredValue * 3.4; // 1M ~ 3.4%
                    } else if (sterKey === "naocl") {
                        currentPercent = desiredValue * 7.45; // 1M ~ 7.45%
                    } else if (ster.mw) {
                        currentPercent = (desiredValue * ster.mw) / 10;
                    }
                }

                if (sterKey === "h2o2") {
                    if (currentPercent > 10) {
                        warnings.push("‚ö†Ô∏è Corrosive: Concentration > 10% can cause skin burns.");
                    } else {
                        warnings.push("‚ÑπÔ∏è Oxidizing agent: Handle with care.");
                    }
                }

                if (sterKey === "naocl") {
                    if (currentPercent > 2) {
                        warnings.push("‚ö†Ô∏è Tissue damage risk: Concentration > 2% is highly irritating.");
                    } else {
                        warnings.push("‚ÑπÔ∏è Bleaching agent: Avoid contact with skin/eyes.");
                    }
                }

                if (warnings.length > 0) {
                    warningBox.style.display = "block";
                    warningText.innerHTML = warnings.join("<br>");
                } else {
                    warningBox.style.display = "none";
                }
            }

            document.getElementById("s1_desired_conc").addEventListener("input", updateSterUI);

            sterTypeSelect.addEventListener("change", updateSterUI);
            sterToggle.addEventListener("click", function (e) {
                const option = e.target.closest(".mode-option");
                if (!option) return;
                sterToggle.querySelectorAll(".mode-option").forEach(opt => opt.classList.remove("active"));
                option.classList.add("active");
                sterModeInput.value = option.getAttribute("data-value");
                updateSterUI();
            });

            window.calculateSterilization = function () {
                const sterKey = sterTypeSelect.value;
                const ster = sterData[sterKey];
                const mode = sterModeInput.value;

                let finalVol = Number(document.getElementById("s1_final_vol").value);
                const volUnit = document.querySelector('input[name="ster-vol-unit"]:checked').value;
                const finalVol_display = finalVol;
                const finalVol_unit_display = volUnit;
                if (volUnit === "L") finalVol = finalVol * 1000; // Work in mL internally

                const desiredValue = Number(document.getElementById("s1_desired_conc").value);
                const desiredUnit = mode === "molarity" ? document.querySelector('input[name="ster-molar-unit"]:checked').value : "%";

                const resultBox = document.getElementById("ster-result");
                const resultText = document.getElementById("ster-result-text");

                if (!sterKey) {
                    resultBox.style.display = "block";
                    resultBox.style.borderColor = "#ff4d4d";
                    resultText.innerHTML = "‚ö†Ô∏è Please select a sterilant type.";
                    return;
                }

                if (desiredValue <= 0 || finalVol <= 0) {
                    resultBox.style.display = "block";
                    resultBox.style.borderColor = "#ff4d4d";
                    resultText.innerHTML = "‚ö†Ô∏è Please enter valid, non-zero values.";
                    return;
                }

                resultBox.style.display = "block";
                resultBox.style.borderColor = "rgba(0, 166, 81, 0.3)";

                let instructions = "";
                const sterName = sterTypeSelect.options[sterTypeSelect.selectedIndex].text;

                if (mode === "percentage") {
                    if (ster.type === "liquid") {
                        const stockConc = Number(document.getElementById("s1_stock_conc").value);
                        const v1 = (desiredValue * finalVol) / stockConc;
                        const water = finalVol - v1;
                        instructions = `Measure <b>${v1.toFixed(2)} mL</b> of stock <b>${sterName}</b> (${stockConc}%) and add it to <b>${water.toFixed(2)} mL</b> of distilled water to make a final volume of <b>${finalVol_display} ${finalVol_unit_display}</b>.`;
                    } else {
                        const grams = (desiredValue * finalVol) / 100;
                        const weightDisplay = grams >= 1 ? `${grams.toFixed(4)} g` : `${(grams * 1000).toFixed(2)} mg`;
                        instructions = `Weigh <b>${weightDisplay}</b> of <b>${sterName}</b> powder and dissolve it in distilled water, making up the total volume to <b>${finalVol_display} ${finalVol_unit_display}</b>. ${sterKey === 'caocl2' ? '<br><br><b>Note:</b> Filter the solution before use to remove insoluble particles.' : ''}`;
                    }
                } else {
                    // Molarity based
                    let actualMValue = desiredUnit === "mM" ? desiredValue / 1000 : desiredValue;
                    const grams = actualMValue * ster.mw * (finalVol / 1000);
                    const weightDisplay = grams >= 1 ? `${grams.toFixed(4)} g` : `${(grams * 1000).toFixed(2)} mg`;
                    instructions = `Weigh <b>${weightDisplay}</b> of <b>${sterName}</b> (MW: ${ster.mw} g/mol) and dissolve it in distilled water, making up the total volume to <b>${finalVol_display} ${finalVol_unit_display}</b> to achieve a <b>${desiredValue} ${desiredUnit}</b> solution.`;
                }

                resultText.innerHTML = `
                    ${instructions}
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px dashed rgba(255,255,255,0.1); font-size: 0.85em; opacity: 0.9;">
                        <b>üìù Expert Recommendation:</b><br>
                        ‚Ä¢ <b>Rec. Working Conc:</b> ${ster.rec}<br>
                        ‚Ä¢ <b>Exposure Time:</b> ${ster.time}<br>
                        ‚Ä¢ <b>Typical Use:</b> ${ster.use}
                    </div>
                `;
            };

            // Init UI
            updateSterUI();

            // Toggle Helper for M/mM
            window.toggleMolarityUnit = function (el) {
                const parent = el.closest('.mode-toggle');
                parent.querySelectorAll('.mode-option').forEach(opt => opt.classList.remove('active'));
                el.closest('.mode-option').classList.add('active');
            };

            // Phosphate Buffer Logic
            window.calculatePhosphateBuffer = function () {
                const type = document.querySelector('input[name="pb-type"]:checked').value;
                const ph = parseFloat(document.getElementById("pb-ph").value);
                const targetInputVal = parseFloat(document.getElementById("pb-target-m").value);
                const targetUnit = document.querySelector('input[name="pb-target-unit"]:checked').value;
                const targetM = targetUnit === "mM" ? targetInputVal / 1000 : targetInputVal;

                const stockM = parseFloat(document.getElementById("pb-stock-m").value);
                const finalInputVol = parseFloat(document.getElementById("pb-final-vol").value);
                const finalInputUnit = document.querySelector('input[name="pb-final-unit"]:checked').value;

                const resultBox = document.getElementById("pb-result");
                const resultText = document.getElementById("pb-result-text");
                const eduBox = document.getElementById("pb-educational");
                const eduContent = document.getElementById("pb-edu-content");

                // Input Validation
                if (isNaN(ph) || isNaN(targetInputVal) || isNaN(stockM) || isNaN(finalInputVol) || targetInputVal <= 0 || stockM <= 0 || finalInputVol <= 0) {
                    resultBox.style.display = "block";
                    resultBox.style.borderColor = "#ff4d4d";
                    resultText.innerHTML = "‚ö†Ô∏è Please enter valid, positive values for all fields.";
                    eduBox.style.display = "none";
                    return;
                }

                if (targetM > stockM) {
                    resultBox.style.display = "block";
                    resultBox.style.borderColor = "#ff4d4d";
                    resultText.innerHTML = "‚ö†Ô∏è <b>Buffer calculation inconsistent:</b> Target molarity cannot be greater than stock molarity.";
                    eduBox.style.display = "none";
                    return;
                }

                // Convert input volume to mL for standard calculation
                const finalVolML = finalInputUnit === "L" ? finalInputVol * 1000 : finalInputVol;

                // 1. Calculate Total Stock Volume Needed (C1V1 = C2V2)
                const totalStockVol = (targetM / stockM) * finalVolML;

                // 2. Henderson-Hasselbalch: pH = pKa + log([Base]/[Acid])
                // [Base]/[Acid] = 10^(pH - pKa)
                const pKa = 7.21;
                const ratio = Math.pow(10, ph - pKa); // Base/Acid ratio

                // For exact match with scientific reference examples (rounding ratio to 3 decimals)
                const roundedRatio = Math.round(ratio * 1000) / 1000;

                // 3. Solving for vAcid and vBase
                // vAcid + vBase = totalStockVol
                // vBase / vAcid = roundedRatio => vBase = vAcid * roundedRatio
                // vAcid + (vAcid * roundedRatio) = totalStockVol
                // vAcid = totalStockVol / (1 + roundedRatio)
                const vAcidML = totalStockVol / (1 + roundedRatio);
                const vBaseML = totalStockVol - vAcidML;

                // Validation of logic
                if (isNaN(vAcidML) || isNaN(vBaseML)) {
                    resultBox.style.display = "block";
                    resultBox.style.borderColor = "#ff4d4d";
                    resultText.innerHTML = "‚ö†Ô∏è <b>Buffer calculation inconsistent:</b> Check pH or stock concentration.";
                    eduBox.style.display = "none";
                    return;
                }

                const acidName = type === "sodium" ? "NaH‚ÇÇPO‚ÇÑ" : "KH‚ÇÇPO‚ÇÑ";
                const baseName = type === "sodium" ? "Na‚ÇÇHPO‚ÇÑ" : "K‚ÇÇHPO‚ÇÑ";

                function formatVol(valML) {
                    if (valML >= 1000) return `<b>${(valML / 1000).toFixed(2)} L</b>`;
                    if (valML >= 1) return `<b>${valML.toFixed(2)} mL</b>`;
                    return `<b>${(valML * 1000).toFixed(2)} ¬µL</b>`;
                }

                // Formatted outputs for display (plain text for SOP)
                const acidVolText = vAcidML >= 1 ? `${vAcidML.toFixed(2)} mL` : `${(vAcidML * 1000).toFixed(2)} ¬µL`;
                const baseVolText = vBaseML >= 1 ? `${vBaseML.toFixed(2)} mL` : `${(vBaseML * 1000).toFixed(2)} ¬µL`;
                const displayFinalVol = finalInputUnit === "L" ? `${finalInputVol} L` : `${finalInputVol} mL`;

                resultBox.style.display = "block";
                resultBox.style.borderColor = "rgba(0, 166, 81, 0.3)";

                resultText.innerHTML = `
                    <span class="step-heading">Step 1: Measurement</span>
                    Measure the following volumes of your stock solutions:
                    <ul>
                        <li>Measure ${formatVol(vAcidML)} of <b>${acidName}</b> (${stockM} M)</li>
                        <li>Measure ${formatVol(vBaseML)} of <b>${baseName}</b> (${stockM} M)</li>
                    </ul>

                    <span class="step-heading">Step 2: Dilution & pH Check</span>
                    Mix the stock solutions and <b>dilute with distilled water to a final volume of ${displayFinalVol}</b>. Check the pH using a calibrated meter and adjust slightly if needed.

                    <div style="margin-top: 20px; font-size: 0.85em; opacity: 0.85; line-height: 1.6;">
                        <b>üìù Note (Publication-Ready SOP):</b><br>
                        "${type === 'sodium' ? 'Sodium' : 'Potassium'} phosphate buffer (${targetInputVal} ${targetUnit}) was prepared by mixing ${acidVolText} of ${acidName} and ${baseVolText} of ${baseName} stock solutions (${stockM} M each). The solution was diluted with distilled water to a final volume of ${displayFinalVol} and adjusted to pH ${ph}."
                    </div>
                `;

                // Educational Details Output
                eduBox.style.display = "block";
                eduContent.innerHTML =
                    `Condition 1: Final Molarity (C‚ÇÅV‚ÇÅ = C‚ÇÇV‚ÇÇ)
Target Molarity = ${targetInputVal} ${targetUnit} (${targetM.toFixed(6)} M)
Total Stock Volume = (${targetM.toFixed(6)} M / ${stockM} M) √ó ${finalVolML} mL = ${totalStockVol.toFixed(2)} mL
V_acid + V_base = ${totalStockVol.toFixed(2)} mL

Condition 2: pH Ratio (Henderson‚ÄìHasselbalch)
pH = pKa + log([Base]/[Acid])
${ph} = 7.21 + log(Ratio)
Ratio = 10^(${ph} - 7.21) = ${ratio.toFixed(4)} (‚âà ${roundedRatio})

Solution:
V_acid = ${totalStockVol.toFixed(2)} / (1 + ${roundedRatio}) = ${vAcidML.toFixed(2)} mL
V_base = ${totalStockVol.toFixed(2)} - ${vAcidML.toFixed(2)} = ${vBaseML.toFixed(2)} mL`;
            };
        });
    </script>
</body>

</html>